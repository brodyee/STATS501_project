---
title: "R Notebook"
output: html_notebook
---

```{r}
library("nlme")
library("mgcv")
library("lattice")
library("tidyverse")
library("stringr") 
library("plot3D")
```

```{r}
setwd('C:/Users/danie/OneDrive/Documents/stats501/STATS501_project/data')
econ_dat = read_delim('violenceKNN.csv', delim = ",")
```
```{r}
#econ_dat$`Median Household Income in Dollars` = substring(econ_dat$`Median Household Income in Dollars`,2) 
#econ_dat$`Median Household Income in Dollars` = str_replace_all(econ_dat$`Median Household Income in Dollars`, "[,]", "") 
#as.double(econ_dat$`Median Household Income in Dollars`)

#setwd('C:/Users/danie/OneDrive/Documents/stats501/STATS501_project/data')
#write.csv(econ_dat, 'violenceKNN.csv')
```

```{r}
## Group by County

# Use all age poverty percent
mod_all_reml = lme(violenceScore ~ AllAgesInPovertyPercent + MedianHouseholdIncomeInDollars + UnemploymentRate + Population + SNAP, random = ~ 1 | sitename, data = econ_dat)

mod_all_ml = lme(violenceScore ~ AllAgesInPovertyPercent + MedianHouseholdIncomeInDollars + UnemploymentRate + Population + SNAP, random = ~ 1 | sitename, method = "ML", data = econ_dat)

# Use under 18 poverty percent
mod_und_reml = lme(violenceScore ~ UnderAge18InPovertyPercent + MedianHouseholdIncomeInDollars + UnemploymentRate + Population + SNAP, random = ~ 1 | sitename, data = econ_dat)

mod_und_ml = lme(violenceScore ~ UnderAge18InPovertyPercent + MedianHouseholdIncomeInDollars + UnemploymentRate + Population + SNAP, random = ~ 1 | sitename, method = "ML", data = econ_dat)
```

```{r}
summary(mod_all_reml)
summary(mod_all_ml)
summary(mod_und_reml)
summary(mod_und_ml)
```

```{r}
# Dropping each predictor

mod_und_reml_pov = lme(violenceScore ~ MedianHouseholdIncomeInDollars + UnemploymentRate + Population + SNAP, random = ~ 1 | sitename, data = econ_dat)

mod_und_reml_med = lme(violenceScore ~ UnderAge18InPovertyPercent + UnemploymentRate + Population + SNAP, random = ~ 1 | sitename, data = econ_dat)


mod_und_reml_unemp = lme(violenceScore ~ UnderAge18InPovertyPercent + MedianHouseholdIncomeInDollars + Population + SNAP, random = ~ 1 | sitename, data = econ_dat)

mod_und_reml_pop = lme(violenceScore ~ UnderAge18InPovertyPercent + MedianHouseholdIncomeInDollars + UnemploymentRate + SNAP, random = ~ 1 | sitename, data = econ_dat)

mod_und_reml_snap = lme(violenceScore ~ UnderAge18InPovertyPercent + MedianHouseholdIncomeInDollars + UnemploymentRate + Population, random = ~ 1 | sitename, data = econ_dat)
```

```{r}
# Using under 18 poverty rate
mod_und_reml_2 = lme(violenceScore ~ UnderAge18InPovertyPercent + UnemploymentRate + SNAP, random = ~ 1 | sitename, data = econ_dat)
mod_und_reml_3 = lme(violenceScore ~ UnemploymentRate + SNAP, random = ~ 1 | sitename, data = econ_dat)

# F test comparing with/without poverty percent
anova(mod_und_reml_2, mod_und_reml_3, test = "F")
```

```{r}
# Using all age poverty percent
mod_und_ml_2 = lme(violenceScore ~ UnderAge18InPovertyPercent + UnemploymentRate + SNAP, random = ~ 1 | sitename, data = econ_dat, method = "ML")
mod_und_ml_3 = lme(violenceScore ~ UnemploymentRate + SNAP, random = ~ 1 | sitename, data = econ_dat, method = "ML")

# F test comparing with/without poverty percent
anova(mod_und_ml_2, mod_und_ml_3, test = "F")
```

```{r}
# Find how to compare between reml and ml
```



```{r}
scatter3D(econ_dat$UnemploymentRate, econ_dat$SNAP, econ_dat$violenceScore, col.var = as.integer(econ_dat$sitename), col = c(1:15), phi = 0)
```

